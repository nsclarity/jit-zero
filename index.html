<!-- 1/2 开始｜复制到 jit2.html 顶部 -->

<!doctype html>

<html lang="zh-CN">

<head>

<meta charset="utf-8" />

<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>JIT零库存挑战</title>

<style>

:root{

--bg:#0b1220;

--card:#111a2e;

--muted:#9fb0d0;

--text:#e8eeff;

--accent:#4f8cff;

--ok:#22c55e;

--danger:#ef4444;

--border:rgba(255,255,255,.12);

}

*{box-sizing:border-box}

body{

margin:0;

font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial;

background:radial-gradient(1000px 600px at 20% 0%,rgba(79,140,255,.25),transparent 60%),var(--bg);

color:var(--text);

min-height:100vh;

display:flex;

align-items:flex-start;

justify-content:center;

padding:32px 16px;

}

.container{width:100%;max-width:760px}

header{margin-bottom:18px}

h1{margin:0;font-size:28px;letter-spacing:.5px}

.subtitle{margin-top:6px;color:var(--muted)}

.card{

background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));

border:1px solid var(--border);

border-radius:16px;

padding:16px;

}

.row{display:flex;gap:10px;align-items:center}

.input{flex:1}

textarea{

width:100%;

min-height:56px;

resize:vertical;

border-radius:12px;

padding:12px;

border:1px solid var(--border);

background:rgba(0,0,0,.25);

color:var(--text);

outline:none;

}

textarea:focus{

border-color:rgba(79,140,255,.7);

box-shadow:0 0 0 3px rgba(79,140,255,.18)

}

button{

border:0;

background:var(--accent);

color:white;

font-weight:700;

padding:12px 14px;

border-radius:12px;

cursor:pointer;

white-space:nowrap;

}

button:disabled{opacity:.45;cursor:not-allowed}

.hint{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.5}

.statWrap{

margin:14px 0 10px;

display:flex;

align-items:center;

justify-content:space-between;

gap:14px

}

.stat{margin:0;color:var(--text);font-weight:700}

.stat span{color:var(--ok)}

.petBox{

width:230px;

height:230px;

border-radius:16px;

border:1px solid var(--border);

background:rgba(0,0,0,.18);

display:flex;

align-items:center;

justify-content:center;

overflow:hidden;

flex:0 0 230px

}

.petBox img{

width:230px;

height:230px;

object-fit:cover;

image-rendering:pixelated

}

.list{margin-top:10px;display:flex;flex-direction:column;gap:10px}

.item{

display:flex;

gap:12px;

align-items:flex-start;

padding:12px;

border-radius:14px;

border:1px solid var(--border);

background:rgba(0,0,0,.18)

}

.item .meta{min-width:110px;color:var(--muted);font-size:13px}

.item .task{flex:1;white-space:pre-wrap;line-height:1.5}

.item .actions{display:flex;align-items:center;gap:8px}

.checkbox{width:22px;height:22px;cursor:pointer}

.badge{

font-size:12px;

padding:3px 8px;

border-radius:999px;

border:1px solid var(--border);

color:var(--muted)

}

.done .task{opacity:.8;text-decoration:line-through}

.done .badge{color:rgba(34,197,94,.95);border-color:rgba(34,197,94,.45)}

.warning{color:var(--danger);margin-top:10px;font-size:13px}

footer{margin-top:16px;color:var(--muted);font-size:12px}

#adoptScreen{
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: none;
  background: radial-gradient(1000px 600px at 20% 0%, rgba(79,140,255,.25), transparent 60%), var(--bg);
  padding: 32px 16px;
}

/* 领养页整体卡片变小 */
#adoptScreen .dialog{
  width: 360px;          /* 你说“跟礼物差不多”，先给 360，想更小就 320 */
  margin: 0 auto;
}

/* 输入框更小 + 不透明 */
#adoptScreen #petNameInput{
  min-height: 38px;
  height: 38px;
  padding: 8px 10px;
  border-radius: 10px;
  resize: none;
  background: #0b1220;   /* 不透明 */
}

#adoptScreen .row{ gap: 8px; }
#adoptScreen button{ padding: 10px 12px; border-radius: 10px; }

#adoptScreen .dialog{
  width: min(720px, calc(100% - 32px));
  margin: 0 auto;
}

</style>

</head>

<body>

<div class="container">

<header>

<h1>JIT零库存挑战</h1>

<div class="subtitle">Just in Time</div>

</header>

<section class="card">

<div class="row">

<div class="input">

<textarea id="taskInput" placeholder="填写今天只做的一件事…（建议写到可验收的程度）"></textarea>

</div>

<button id="publishBtn">发布任务</button>

</div>

<div class="hint">说明：每天只能发布 1 条（按本机日期）。发布后可在下方列表打勾完成。</div>

<div id="warn" class="warning" style="display:none"></div>

<div class="statWrap">

<div class="stat">恭喜你！已经完成 0 件任务啦</div>

<div class="petBox" title="这里显示你的像素小动物（230×230）">
  <img id="petImg" alt="pet" src="assets/box/0000Z_01.jpg" />
</div>

<div id="adoptScreen" style="display:none">
  <div class="dialog card">
    <div style="display:flex;justify-content:center;margin-bottom:12px">
      <div class="petBox">
        <img id="adoptPreview" alt="box" src="assets/box/0000Z_01.jpg" />
      </div>
    </div>

    <div class="row">
      <div class="input">
        <textarea id="petNameInput" placeholder="请为你的盲盒宠物取个可爱的名字…"></textarea>
      </div>
      <button id="adoptBtn">领养</button>
    </div>
    <div class="hint">领养后会进入挑战页面。</div>
  </div>
</div>

</div>

</div>

</section>

<section class="list" id="history"></section>

<footer>数据保存在浏览器 localStorage（仅本机）。更换设备/清缓存会丢记录。</footer>

</div>

<script>

// === 任务数据 ===

const STORAGE_KEY = 'jit_zero_inventory_tasks_v1';

function todayKey(){

const d = new Date();

const yyyy = d.getFullYear();

const mm = String(d.getMonth()+1).padStart(2,'0');

const dd = String(d.getDate()).padStart(2,'0');

return `${yyyy}-${mm}-${dd}`;

}

function load(){

try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }

catch(e){ return []; }

}

function save(list){

localStorage.setItem(STORAGE_KEY, JSON.stringify(list));

}

function showWarn(msg){

const w = document.getElementById('warn');

w.style.display = 'block';

w.textContent = msg;

setTimeout(()=>{w.style.display='none'; }, 3500);

}

// === 宠物图片规则（按你的命名：0001A_01.jpg）===

const PET = {

BASE: 'assets/pet',

EXT: 'jpg',

ANIMAL_MIN: 1,

ANIMAL_MAX: 1,

KEY_ANIMAL: 'jit_pet_animal_id_v1',

KEY_START: 'jit_pet_start_date_v1'

};

// === 盲盒图（初始状态用）===
const BOX = {
  BASE: 'assets/box',
  EXT: 'jpg',      // 如果你是 jpg 就改成 'jpg'
  MIN: 1,
  MAX: 20,
  KEY: 'jit_box_pick_v1' // 让“今天”固定一张，不会每次刷新乱跳
};

// === 领养流程 ===
const ADOPT = {
  KEY_DONE: 'jit_adopt_done_v1',
  KEY_NAME: 'jit_pet_name_v1'
};

function isAdopted(){
  return localStorage.getItem(ADOPT.KEY_DONE) === '1';
}

function showAdoptPanel(show){
  const m = document.getElementById('adoptScreen');
  if(!m) return;
  m.style.display = show ? 'block' : 'none';

  if(show){
    const img = document.getElementById('adoptPreview');
    if(img){
      const n = pickBoxIndexForToday();
      img.src = `${BOX.BASE}/${boxFilename(n)}`;
    }
  }
}

function adoptNow(){
  const input = document.getElementById('petNameInput');
  const name = (input?.value || '').trim();
  if(!name){
    showWarn('先给宠物取个名字再领养～');
    return;
  }

  // 记录名字 + 标记已领养
  localStorage.setItem(ADOPT.KEY_NAME, name);
  localStorage.setItem(ADOPT.KEY_DONE, '1');

  // 关键：领养当天开始 Day1（你说“第一天还是一开始那只小动物”）
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,'0');
  const dd = String(now.getDate()).padStart(2,'0');
  const start = `${yyyy}-${mm}-${dd}`;

  localStorage.setItem(PET.KEY_START, start);

  // 固定/随机选择一只宠物（两选一）
  // 1) 固定小兔子：如果你的小兔子编号就是 1，那就固定 1
  // localStorage.setItem(PET.KEY_ANIMAL, '1');

  // 2) 或者随机一只（如果你以后有多只，先留着）
  // const id = Math.floor(Math.random() * (PET.ANIMAL_MAX - PET.ANIMAL_MIN + 1)) + PET.ANIMAL_MIN;
  // localStorage.setItem(PET.KEY_ANIMAL, String(id));

  showAdoptPanel(false);
  render(); // 领养后立刻进入正常页面（会按今天状态显示宠物 A/B/C 或 B）

}

function pickBoxIndexForToday(){
  const key = `${BOX.KEY}:${todayKey()}`;
  let n = parseInt(localStorage.getItem(key) || '', 10);
  if(!n || Number.isNaN(n)){
    n = Math.floor(Math.random() * (BOX.MAX - BOX.MIN + 1)) + BOX.MIN;
    localStorage.setItem(key, String(n));
  }
  return n;
}

function boxFilename(n){
  return `0000Z_${String(n).padStart(2,'0')}.${BOX.EXT}`;
}

function setBox(){
  const img = document.getElementById('petImg');
  if(!img) return;

  const n = pickBoxIndexForToday();
  img.src = `${BOX.BASE}/${boxFilename(n)}`;

  img.onerror = () => {
    img.onerror = null;
    // 兜底：如果盲盒缺图，就回到宠物 Day1
    img.src = `${PET.BASE}/${petFilename('A', 1)}`;
  };
}

function pad2(n){ return String(n).padStart(2,'0'); }

function pad4(n){ return String(n).padStart(4,'0'); }

function getOrInitStartDate(){

let s = localStorage.getItem(PET.KEY_START);

if(!s){

const now = new Date();

const yyyy = now.getFullYear();

const mm = String(now.getMonth()+1).padStart(2,'0');

const dd = String(now.getDate()).padStart(2,'0');

s = `${yyyy}-${mm}-${dd}`;

localStorage.setItem(PET.KEY_START, s);

}

return s;

}

function dayIndex(){

const startStr = getOrInitStartDate();

const start = new Date(startStr + 'T00:00:00');

const now = new Date();

const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

const diffDays = Math.floor((today - start) / (24*60*60*1000));

return Math.max(1, diffDays + 1);

}

function getOrPickAnimalId(){

let id = parseInt(localStorage.getItem(PET.KEY_ANIMAL) || '', 10);

if(!id || Number.isNaN(id)){

id = Math.floor(Math.random() * (PET.ANIMAL_MAX - PET.ANIMAL_MIN + 1)) + PET.ANIMAL_MIN;

localStorage.setItem(PET.KEY_ANIMAL, String(id));

}

return id;

}

function petFilename(stage, day){

const dayPart = day < 100 ? pad2(day) : String(day);

const animalPart = pad4(getOrPickAnimalId());

return `${animalPart}${stage}_${dayPart}.${PET.EXT}`;

}

function setPet(stage){

const day = dayIndex();

const img = document.getElementById('petImg');

if(!img) return;

img.src = `${PET.BASE}/${petFilename(stage, day)}`;

img.onerror = () => {
	img.onerror = null; // 关键：防止无限循环
	img.src = `${PET.BASE}/${petFilename('A', 1)}`;
};

}


















<!-- 2/2 开始｜把下面内容紧接着粘在 1/2 后面（不要另起文件） -->

function render(){

  // ✅ 领养前：只显示领养首屏，不渲染后面的主页面内容
  if(!isAdopted()){
    showAdoptPanel(true);
    return;
  }

const list = load();

// 新到旧：先按日期，再按创建时间

list.sort((a,b)=> (

(a.date < b.date ? 1 : a.date > b.date ? -1 : (b.createdAt - a.createdAt))

));

// 更新完成数

const done = list.filter(x=>x.done).length;

const dc = document.getElementById('doneCount');

if(dc) dc.textContent = String(done);

document.getElementById('doneCount'); if(dc) dc.textContent = String(done);

// 渲染历史

const wrap = document.getElementById('history');

wrap.innerHTML = '';

if(list.length === 0){

wrap.innerHTML = `<div class="card" style="text-align:center;color:var(--muted)">还没有记录。先发布今天的一件事吧。</div>`;

} else {

for(const item of list){

const el = document.createElement('div');

el.className = 'item' + (item.done ? ' done' : '');

el.innerHTML = `

<div class="meta">${item.date}</div>

<div class="task"></div>

<div class="actions">

<input class="checkbox" type="checkbox" ${item.done ? 'checked' : ''} />

${item.done ? '已完成' : '未完成'}

</div>

`;

el.querySelector('.task').textContent = item.task;

el.querySelector('input').addEventListener('change', (e)=>{

const list2 = load();

const target = list2.find(x=>x.id===item.id);

if(target){

target.done = e.target.checked;

save(list2);

render();

}

});

wrap.appendChild(el);

}

}

// === 宠物状态（A/B/C）===

// A：今天没任务

// B：今天有任务但未完成

// C：今天有任务且已完成

const today = todayKey();

const todayItem = list.find(x => x.date === today);

if(todayItem && todayItem.done) setPet('C');

else if(todayItem && !todayItem.done) setPet('B');

else {
  if(!isAdopted()){
    setBox();
    showAdoptPanel(true);
  } else {
    setPet('A');      // 已领养但今天没任务：显示宠物A（Day1起）
    showAdoptPanel(false);
  }
}

}

document.getElementById('publishBtn').addEventListener('click', ()=>{

  // 还没领养：先让用户领养（输入名字 + 点领养）
  if(!isAdopted()){
    showAdoptPanel(true);
    showWarn('先领养你的盲盒宠物，再发布今天的一件事～');
    return;
  }

  const task = document.getElementById('taskInput').value.trim();

if(!task){

showWarn('先写下今天的一件事再发布。');

return;

}

const list = load();

const tkey = todayKey();

const already = list.some(x=>x.date===tkey);

if(already){

showWarn('今天已经发布过 1 条任务了。每天只完成一件事。');

return;

}

list.push({

id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random()),

date: tkey,

task,

done: false,

createdAt: Date.now()

});

save(list);

document.getElementById('taskInput').value = '';

render();

});

// 首次渲染

render();

document.getElementById('adoptBtn')?.addEventListener('click', adoptNow);

</script>

</body>

</html>